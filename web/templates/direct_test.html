<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minerva Direct API Test</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        #responseContainer {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f0f0f0;
            min-height: 100px;
        }
        #rawOutputContainer {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }
        .status-bar {
            margin-top: 10px;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2 class="mb-4">Minerva Direct API Test</h2>
        <p class="text-muted">This page tests the direct API endpoint that bypasses validation.</p>
        
        <form id="messageForm">
            <div class="mb-3">
                <label for="messageInput" class="form-label">Enter your message:</label>
                <textarea class="form-control" id="messageInput" rows="3" placeholder="Type your message here..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Send Message</button>
            <button type="button" id="toggleRawBtn" class="btn btn-outline-secondary">Show Raw Output</button>
        </form>
        
        <div class="status-bar" id="statusBar">Status: Ready</div>
        
        <div id="responseContainer">
            <p class="text-muted">Response will appear here...</p>
        </div>
        
        <div id="rawOutputContainer">Raw output will appear here...</div>
    </div>

    <!-- Bootstrap and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function() {
            const messageForm = $('#messageForm');
            const messageInput = $('#messageInput');
            const responseContainer = $('#responseContainer');
            const rawOutputContainer = $('#rawOutputContainer');
            const toggleRawBtn = $('#toggleRawBtn');
            const statusBar = $('#statusBar');
            
            // Toggle raw output display
            toggleRawBtn.click(function() {
                if (rawOutputContainer.is(':visible')) {
                    rawOutputContainer.hide();
                    $(this).text('Show Raw Output');
                } else {
                    rawOutputContainer.show();
                    $(this).text('Hide Raw Output');
                }
            });
            
            // Handle form submission
            messageForm.submit(function(e) {
                e.preventDefault();
                
                const message = messageInput.val().trim();
                if (!message) return;
                
                // Update status
                statusBar.text('Status: Sending request...');
                responseContainer.html('<p>Processing...</p>');
                rawOutputContainer.hide();
                
                // Send request to direct API
                $.ajax({
                    url: '/api/direct',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ message: message }),
                    success: function(data) {
                        statusBar.text(`Status: Response received in ${((new Date()).getTime() / 1000 - startTime).toFixed(2)}s`);
                        
                        if (data.success) {
                            // Format and display response
                            responseContainer.html(`<p>${data.response.replace(/\n/g, '<br>')}</p>`);
                            
                            // Show raw output
                            rawOutputContainer.text(JSON.stringify(data, null, 2));
                        } else {
                            responseContainer.html(`<p class="text-danger">Error: ${data.error || 'Unknown error'}</p>`);
                        }
                    },
                    error: function(xhr, status, error) {
                        statusBar.text('Status: Error');
                        responseContainer.html(`<p class="text-danger">Request failed: ${error}</p>`);
                        console.error('Request failed:', error);
                    }
                });
                
                // Record start time
                const startTime = (new Date()).getTime() / 1000;
            });
        });
    </script>
</body>
</html>

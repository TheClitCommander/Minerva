<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #121212; color: #fff; }
        #result { white-space: pre-wrap; background: #1e1e1e; padding: 15px; border-radius: 5px; overflow: auto; max-height: 500px; }
        button { background: #0046ad; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        h1 { color: #42a5f5; }
    </style>
</head>
<body>
    <h1>Minerva Think Tank API Test</h1>
    <p>Click the button below to test the API response directly:</p>
    <button id="test-api">Test API Response</button>
    <p>Raw API Response (will show exactly what the server returns):</p>
    <pre id="result">Results will appear here...</pre>

    <script>
        document.getElementById('test-api').addEventListener('click', function() {
            const resultArea = document.getElementById('result');
            resultArea.textContent = 'Sending request...';
            
            fetch('/api/think-tank', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: "Hello, this is a test message", 
                    store_in_memory: true 
                })
            })
            .then(response => {
                resultArea.textContent = 'Response received. Status: ' + response.status;
                return response.text(); // Get raw text first to debug
            })
            .then(text => {
                resultArea.textContent = 'Raw response text:\n\n' + text;
                
                // Also try to parse as JSON if possible
                try {
                    const json = JSON.parse(text);
                    resultArea.textContent += '\n\n=== Parsed as JSON ===\n\n';
                    
                    // Print each key and its type for debugging
                    Object.keys(json).forEach(key => {
                        resultArea.textContent += `Key: ${key}, Type: ${typeof json[key]}, Value: ${JSON.stringify(json[key])}\n`;
                    });
                    
                    // If there's a response key, check its type
                    if (json.response !== undefined) {
                        resultArea.textContent += '\n=== Response Property ===\n';
                        resultArea.textContent += `Type: ${typeof json.response}\n`;
                        resultArea.textContent += `Raw value: ${json.response}\n`;
                        
                        if (typeof json.response === 'object' && json.response !== null) {
                            resultArea.textContent += `Stringified: ${JSON.stringify(json.response)}\n`;
                        }
                    }
                } catch (e) {
                    resultArea.textContent += '\n\nError parsing JSON: ' + e.message;
                }
            })
            .catch(error => {
                resultArea.textContent = 'Error: ' + error.message;
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minerva 3D Orbital Interface</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .info-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 14, 23, 0.8);
            color: #fff;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 300px;
            border: 1px solid rgba(111, 66, 193, 0.5);
            z-index: 100;
            box-shadow: 0 0 20px rgba(111, 66, 193, 0.4);
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #9c5ddb;
            font-size: 16px;
        }
        
        .info-panel p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .think-tank-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(111, 66, 193, 0.2);
            color: #9c5ddb;
            border: 1px solid rgba(111, 66, 193, 0.5);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            z-index: 100;
            backdrop-filter: blur(5px);
            transition: all 0.2s;
        }
        
        .think-tank-button:hover {
            background: rgba(111, 66, 193, 0.3);
            box-shadow: 0 0 15px rgba(111, 66, 193, 0.6);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0A0E17 0%, #131C2E 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: #fff;
            transition: opacity 0.5s;
        }
        
        .loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 3px solid rgba(111, 66, 193, 0.3);
            border-radius: 50%;
            border-top-color: #9c5ddb;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div>Loading Minerva Interface...</div>
    </div>
    
    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>
    
    <!-- Info Panel for Selected Orb -->
    <div id="info-panel" class="info-panel">
        <h3 id="info-title">Project Name</h3>
        <p id="info-description">Project description will appear here when you select a sphere in the 3D interface.</p>
    </div>
    
    <!-- Think Tank Button -->
    <button id="think-tank-button" class="think-tank-button">Open Think Tank</button>
    
    <!-- Load Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // Wait for Three.js to load
        window.addEventListener('load', initializeScene);
        
        // Define the main variables
        let scene, camera, renderer, controls;
        let projectOrbs = [];
        let agentOrbs = [];
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let selectedOrb = null;
        
        // Center Minerva orb data
        let minervaOrb;
        const minervaData = {
            name: "Minerva",
            description: "Central AI system with Think Tank capabilities",
            position: [0, 0, 0],
            color: 0x9c5ddb,
            scale: 1.5
        };
        
        // No project orbs yet - will be added when project creation is defined
        
        function initializeScene() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0e17);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Add orbital controls with zoom limits
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            // Set zoom limits with extended outer range
            controls.minDistance = 8;    // Can't zoom in closer than 8 units
            controls.maxDistance = 180;  // Allow zooming out much further (10x previous limit)
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);
            
            // Add point light at center with Minerva glow
            const pointLight = new THREE.PointLight(0x9c5ddb, 1.0);
            pointLight.position.set(0, 0, 0);
            scene.add(pointLight);
            
            // Add white ambient light to balance the scene
            const secondaryLight = new THREE.PointLight(0xffffff, 0.6);
            secondaryLight.position.set(0, 5, 0);
            scene.add(secondaryLight);
            
            // Add stars to background
            addStars();
            
            // Create project orbs
            createProjectOrbs();
            
            // Add event listeners
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onMouseClick);
            
            // Add click listener for Think Tank button
            document.getElementById('think-tank-button').addEventListener('click', openThinkTank);
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('fade-out');
            }, 1500);
            
            // Start animation loop
            animate();
        }
        
        function createProjectOrbs() {
            // Create central Minerva orb only
            const minervaGeometry = new THREE.SphereGeometry(1.5, 32, 32);
            const minervaMaterial = new THREE.MeshStandardMaterial({
                color: minervaData.color,
                emissive: minervaData.color,
                emissiveIntensity: 0.7,
                roughness: 0.2,
                metalness: 0.9
            });
            
            minervaOrb = new THREE.Mesh(minervaGeometry, minervaMaterial);
            minervaOrb.position.set(...minervaData.position);
            minervaOrb.userData = {
                type: 'minerva',
                name: minervaData.name,
                description: minervaData.description
            };
            
            scene.add(minervaOrb);
            projectOrbs.push(minervaOrb); // Add to the clickable orbs
            
            // Create a subtle pulsing animation for Minerva
            function animateMinerva() {
                const scale = 1 + 0.05 * Math.sin(Date.now() * 0.001);
                minervaOrb.scale.set(scale, scale, scale);
                requestAnimationFrame(animateMinerva);
            }
            animateMinerva();
        }
        
        function createAgentOrb(parentOrb, color, index) {
            const geometry = new THREE.SphereGeometry(0.2, 16, 16);
            const material = new THREE.MeshStandardMaterial({
                color: color,
                emissive: color,
                emissiveIntensity: 0.7,
                roughness: 0.3,
                metalness: 0.7
            });
            
            const orb = new THREE.Mesh(geometry, material);
            
            // Set initial position on orbit
            const angle = (index / 5) * Math.PI * 2;
            const orbit = 1.5 + Math.random() * 0.5;
            orb.position.x = Math.cos(angle) * orbit;
            orb.position.z = Math.sin(angle) * orbit;
            
            // Reference to parent for orbiting
            orb.userData = {
                type: 'agent',
                parent: parentOrb,
                orbit: orbit,
                speed: 0.005 + Math.random() * 0.01,
                angle: angle
            };
            
            // Create orbit group to position relative to parent
            const orbGroup = new THREE.Group();
            orbGroup.add(orb);
            orbGroup.position.copy(parentOrb.position);
            
            scene.add(orbGroup);
            agentOrbs.push({ orb, orbGroup });
        }
        
        function addStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1
            });
            
            const starVertices = [];
            
            for (let i = 0; i < 2000; i++) {
                const x = (Math.random() - 0.5) * 100;
                const y = (Math.random() - 0.5) * 100;
                const z = (Math.random() - 0.5) * 100;
                starVertices.push(x, y, z);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Update orbital controls
            controls.update();
            
            // Animate project orbs (gentle floating)
            projectOrbs.forEach(orb => {
                orb.rotation.y += 0.002;
                // Subtle floating motion
                orb.position.y += Math.sin(Date.now() * 0.001) * 0.001;
            });
            
            // Animate agent orbs (orbiting)
            agentOrbs.forEach(({ orb, orbGroup }) => {
                // Update agent orb position around its parent
                orb.userData.angle += orb.userData.speed;
                orb.position.x = Math.cos(orb.userData.angle) * orb.userData.orbit;
                orb.position.z = Math.sin(orb.userData.angle) * orb.userData.orbit;
                orb.rotation.y += 0.01;
                
                // Make orbits non-circular by adjusting y position
                orb.position.y = Math.sin(orb.userData.angle * 2) * 0.2;
            });
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function onMouseMove(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Check for hover over orbs
            checkOrbIntersection();
        }
        
        function onMouseClick(event) {
            // Check if an orb was clicked
            raycaster.setFromCamera(mouse, camera);
            
            // Check for project orb intersections
            const intersects = raycaster.intersectObjects(projectOrbs);
            
            if (intersects.length > 0) {
                selectedOrb = intersects[0].object;
                
                // Show info panel
                const infoPanel = document.getElementById('info-panel');
                document.getElementById('info-title').textContent = selectedOrb.userData.name;
                document.getElementById('info-description').textContent = selectedOrb.userData.description;
                infoPanel.style.display = 'block';
                
                // If Think Tank was clicked, open that view
                if (selectedOrb.userData.name === "Think Tank") {
                    openThinkTank();
                }
            } else {
                // Hide info panel if clicking elsewhere
                document.getElementById('info-panel').style.display = 'none';
                selectedOrb = null;
            }
        }
        
        function checkOrbIntersection() {
            raycaster.setFromCamera(mouse, camera);
            
            // Check for project orb intersections
            const intersects = raycaster.intersectObjects(projectOrbs);
            
            // Reset all orbs to original scale
            projectOrbs.forEach(orb => {
                if (orb !== selectedOrb) {
                    orb.scale.set(1, 1, 1);
                }
            });
            
            // Highlight hovered orb
            if (intersects.length > 0) {
                const hoveredOrb = intersects[0].object;
                if (hoveredOrb !== selectedOrb) {
                    hoveredOrb.scale.set(1.1, 1.1, 1.1);
                    document.body.style.cursor = 'pointer';
                }
            } else {
                document.body.style.cursor = 'auto';
            }
        }
        
        function openThinkTank() {
            // Redirect to Think Tank page
            window.location.href = '/minerva_functional_ui.html';
        }
    </script>
</body>
</html>

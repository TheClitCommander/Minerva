<!DOCTYPE html>
<html>
<head>
    <title>Minerva Think Tank Memory Demo</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2d3748;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #a0aec0;
        }
        
        .memory-status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #4fd1c5;
            background: #1a202c;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a202c;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            position: relative;
            line-height: 1.5;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #3182ce;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .assistant-message {
            align-self: flex-start;
            background-color: #2d3748;
            color: #e2e8f0;
            border-bottom-left-radius: 5px;
        }
        
        .system-message {
            align-self: center;
            background-color: #4a5568;
            color: #e2e8f0;
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 5px;
            opacity: 0.8;
        }
        
        .memory-tag {
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 3px;
            background-color: #553c9a;
            color: white;
            margin-top: 5px;
            display: inline-block;
        }
        
        .input-container {
            display: flex;
            padding: 10px;
            background-color: #2d3748;
            border-top: 1px solid #4a5568;
        }
        
        input {
            flex: 1;
            padding: 12px 15px;
            background-color: #1a202c;
            border: 1px solid #4a5568;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            outline: none;
        }
        
        button {
            margin-left: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #4299e1;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #3182ce;
        }
        
        .model-info {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 5px;
            align-self: flex-start;
        }
        
        .memory-section {
            margin-top: 20px;
            background: #1a202c;
            border-radius: 10px;
            padding: 15px;
        }
        
        .memory-section h2 {
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: #a0aec0;
        }
        
        .memory-item {
            background: #2d3748;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .memory-content {
            color: #e2e8f0;
        }
        
        .memory-meta {
            display: flex;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #a0aec0;
        }
        
        .memory-meta span {
            margin-right: 10px;
        }
        
        .memory-tag-item {
            background: #553c9a;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Minerva Think Tank Memory Demo</h1>
        <div class="memory-status" id="memory-status">
            ðŸ§  Memory System: Active
        </div>
    </div>
    
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <div class="system-message">
                Welcome to Minerva's Memory-Enabled Think Tank Demo! Try saying something I should remember.
            </div>
        </div>
        
        <div class="input-container">
            <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
            <button id="send-button">Send</button>
        </div>
    </div>
    
    <div class="memory-section">
        <h2>Memory System</h2>
        <div id="memory-items">
            <!-- Memory items will be added here -->
        </div>
    </div>
    
    <script>
        // Memory storage
        let memories = [];
        let conversationHistory = [];
        
        // DOM elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const memoryItems = document.getElementById('memory-items');
        
        // Event listeners
        sendButton.addEventListener('click', handleUserMessage);
        userInput.addEventListener('keydown', event => {
            if (event.key === 'Enter') handleUserMessage();
        });
        
        // Initialize with welcome message
        conversationHistory.push({
            role: 'system',
            content: 'Welcome to Minerva Think Tank with Memory integration!'
        });
        
        // Main function to handle user messages
        function handleUserMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message to chat and history
            addMessageToChat(message, 'user');
            conversationHistory.push({
                role: 'user',
                content: message,
                timestamp: new Date().toISOString()
            });
            userInput.value = '';
            
            // Show "typing" indicator
            const typingIndicator = addTypingIndicator();
            
            // Process message with Think Tank and memory system (simulated)
            setTimeout(() => {
                // Remove typing indicator
                typingIndicator.remove();
                
                // Extract facts from user message
                const facts = extractPotentialFacts(message);
                
                // Check if message is asking about remembered information
                const isQuery = isMemoryQuery(message);
                
                // Get relevant memories if this is a query
                const relevantMemories = isQuery ? getRelevantMemories(message) : [];
                
                // Process with Think Tank (simulated)
                const { response, usedMemories, modelInfo } = processWithThinkTank(
                    message, 
                    conversationHistory,
                    relevantMemories
                );
                
                // Add AI response to chat and history
                addMessageToChat(response, 'assistant');
                conversationHistory.push({
                    role: 'assistant',
                    content: response,
                    timestamp: new Date().toISOString()
                });
                
                // Show model info
                const modelInfoElement = document.createElement('div');
                modelInfoElement.className = 'model-info';
                modelInfoElement.textContent = modelInfo;
                chatMessages.appendChild(modelInfoElement);
                
                // Store facts in memory if any were found
                if (facts.length > 0) {
                    facts.forEach(fact => {
                        // Add to memory system
                        const memory = {
                            id: generateId(),
                            content: fact,
                            category: detectCategory(fact),
                            source: 'conversation',
                            tags: ['auto_extracted'],
                            created_at: Date.now(),
                            last_accessed: Date.now(),
                            access_count: 1
                        };
                        memories.push(memory);
                        
                        // Update UI
                        updateMemoryDisplay();
                    });
                    
                    // Confirm memory storage to user
                    const memoryMessage = facts.length === 1 
                        ? `I've remembered that "${facts[0]}"` 
                        : `I've remembered ${facts.length} facts from our conversation`;
                    
                    setTimeout(() => {
                        addMessageToChat(memoryMessage, 'system');
                    }, 1000);
                }
                
                // If this was a memory query and memories were used
                if (isQuery && usedMemories > 0) {
                    // Add memory tag to response
                    const lastAssistantMessage = document.querySelector('.assistant-message:last-child');
                    const memoryTag = document.createElement('div');
                    memoryTag.className = 'memory-tag';
                    memoryTag.textContent = `ðŸ§  Used ${usedMemories} memories`;
                    lastAssistantMessage.appendChild(memoryTag);
                }
            }, 1500); // Simulate processing time
        }
        
        // Helper to add messages to chat
        function addMessageToChat(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = content;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return messageDiv;
        }
        
        // Add typing indicator
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant-message';
            typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }
        
        // Extract potential facts (simplified)
        function extractPotentialFacts(message) {
            const facts = [];
            
            // Simple rule-based fact extraction
            if (message.includes("I am") || message.includes("I'm")) {
                // Capture personal information
                const match = message.match(/I(?:'m| am) ([^\.!?]+)/i);
                if (match && match[1]) {
                    facts.push(`User is ${match[1].trim()}`);
                }
            }
            
            if (message.includes("I like") || message.includes("I love") || message.includes("I enjoy")) {
                // Capture preferences
                const match = message.match(/I (?:like|love|enjoy) ([^\.!?]+)/i);
                if (match && match[1]) {
                    facts.push(`User likes ${match[1].trim()}`);
                }
            }
            
            if (message.includes("My name is") || message.includes("I'm called")) {
                // Capture name
                const match = message.match(/(?:My name is|I'm called) ([^\.!?]+)/i);
                if (match && match[1]) {
                    facts.push(`User's name is ${match[1].trim()}`);
                }
            }
            
            return facts;
        }
        
        // Check if the message is asking about remembered information
        function isMemoryQuery(message) {
            const memoryQueryTerms = [
                'remember', 'recall', 'said earlier', 'told you', 
                'mentioned', 'previous', 'do you know', 'who am i',
                'what is my', 'what do i'
            ];
            
            return memoryQueryTerms.some(term => message.toLowerCase().includes(term));
        }
        
        // Get relevant memories based on message content
        function getRelevantMemories(message) {
            // Simple keyword matching (in a real system, this would use semantic search)
            return memories.filter(memory => {
                // Look for word overlap
                const messageWords = message.toLowerCase().split(/\s+/);
                const memoryWords = memory.content.toLowerCase().split(/\s+/);
                
                const overlap = messageWords.filter(word => 
                    memoryWords.some(memWord => memWord.includes(word) || word.includes(memWord))
                );
                
                return overlap.length > 0;
            });
        }
        
        // Simulate Think Tank processing
        function processWithThinkTank(message, history, relevantMemories) {
            // Format memory context for Think Tank
            let memoryContext = '';
            if (relevantMemories.length > 0) {
                memoryContext = "Based on our conversation, I remember:\n" + 
                    relevantMemories.map((mem, i) => `${i+1}. ${mem.content}`).join('\n');
                
                // Update memory access stats
                relevantMemories.forEach(memory => {
                    const index = memories.findIndex(m => m.id === memory.id);
                    if (index !== -1) {
                        memories[index].last_accessed = Date.now();
                        memories[index].access_count += 1;
                    }
                });
                
                // Update memory display
                updateMemoryDisplay();
            }
            
            // Generate response based on message and memories
            let response = '';
            if (message.toLowerCase().includes('who am i') || message.toLowerCase().includes('what is my name')) {
                const nameMemory = memories.find(m => m.content.toLowerCase().includes('name'));
                if (nameMemory) {
                    response = `${nameMemory.content}. Is there anything else you'd like to know?`;
                } else {
                    response = "I don't have any information about your name in my memory. Would you like to introduce yourself?";
                }
            } 
            else if (message.toLowerCase().includes('what do i like')) {
                const likeMemories = memories.filter(m => m.content.toLowerCase().includes('like'));
                if (likeMemories.length > 0) {
                    response = `Based on our conversation, ${likeMemories.map(m => m.content).join(' and ')}. Would you like to tell me more about your interests?`;
                } else {
                    response = "I don't have any information about your preferences in my memory. Would you like to tell me about them?";
                }
            }
            else if (relevantMemories.length > 0) {
                // Use memories to craft personalized response
                response = `${memoryContext}\n\nBased on what I remember, I can help you with your question about "${message}". Let me craft a response that takes this into account...`;
            } 
            else {
                // Generic response
                response = `Thank you for your message. I'll process it through the Think Tank and generate a thoughtful response.`;
                
                // Add variation based on message content
                if (message.includes('project')) {
                    response += " Would you like me to help organize this into a new project?";
                } else if (message.includes('remember')) {
                    response += " I'll remember this information for our future conversations.";
                }
            }
            
            // Model info
            const modelInfo = `Models used: gpt-4o, claude-3-sonnet (Think Tank blended response)`;
            
            return {
                response,
                usedMemories: relevantMemories.length,
                modelInfo
            };
        }
        
        // Update memory display
        function updateMemoryDisplay() {
            memoryItems.innerHTML = '';
            
            if (memories.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'system-message';
                emptyMessage.textContent = 'No memories stored yet. Try telling me something about yourself!';
                memoryItems.appendChild(emptyMessage);
                return;
            }
            
            // Sort memories by last accessed (most recent first)
            const sortedMemories = [...memories].sort((a, b) => b.last_accessed - a.last_accessed);
            
            // Display memories
            sortedMemories.forEach(memory => {
                const memoryItem = document.createElement('div');
                memoryItem.className = 'memory-item';
                
                const content = document.createElement('div');
                content.className = 'memory-content';
                content.textContent = memory.content;
                
                const meta = document.createElement('div');
                meta.className = 'memory-meta';
                
                const category = document.createElement('span');
                category.textContent = `Category: ${memory.category}`;
                
                const accessCount = document.createElement('span');
                accessCount.textContent = `Access count: ${memory.access_count}`;
                
                const tags = document.createElement('span');
                tags.innerHTML = memory.tags.map(tag => 
                    `<span class="memory-tag-item">${tag}</span>`
                ).join('');
                
                meta.appendChild(category);
                meta.appendChild(accessCount);
                meta.appendChild(tags);
                
                memoryItem.appendChild(content);
                memoryItem.appendChild(meta);
                memoryItems.appendChild(memoryItem);
            });
        }
        
        // Helper functions
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        function detectCategory(fact) {
            if (fact.toLowerCase().includes('name')) return 'personal_info';
            if (fact.toLowerCase().includes('like') || fact.toLowerCase().includes('enjoy')) return 'preferences';
            if (fact.toLowerCase().includes('work') || fact.toLowerCase().includes('job')) return 'professional';
            return 'general';
        }
        
        // Initialize
        updateMemoryDisplay();
    </script>
</body>
</html>

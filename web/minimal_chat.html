<!DOCTYPE html>
<html>
<head>
    <title>Minimal Minerva Chat</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #chat-messages {
            border: 1px solid #ccc;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .user-message {
            background-color: #e1f5fe;
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .ai-message {
            background-color: #f5f5f5;
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        #chat-input {
            width: 80%;
            padding: 8px;
        }
        #send-button {
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <h1>Minimal Minerva Think Tank Chat</h1>
    <div id="chat-messages"></div>
    <div>
        <input type="text" id="chat-input" placeholder="Type your message...">
        <button id="send-button">Send</button>
    </div>

    <script>
        // Simple chat functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');

            // Add event listeners
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Function to send a message
            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                // Add user message
                addMessage('user', message);
                chatInput.value = '';

                // Show loading indicator
                const loadingId = 'loading-' + Date.now();
                addMessage('ai', 'Thinking...', loadingId);

                // Call API
                fetch('/api/think-tank', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversation_id: 'minimal-test'
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    return response.json();
                })
                .then(data => {
                    // Remove loading message
                    const loadingElement = document.getElementById(loadingId);
                    if (loadingElement) {
                        loadingElement.remove();
                    }

                    // Add AI response
                    const modelInfo = data.model_info ? 
                        `<div style="font-size: 0.8em; margin-top: 8px; color: #666;">Model: ${data.model_info.primary_model || 'Think Tank'}</div>` : '';
                    
                    addMessage('ai', data.response + modelInfo);
                })
                .catch(error => {
                    console.error('Error:', error);
                    
                    // Remove loading message
                    const loadingElement = document.getElementById(loadingId);
                    if (loadingElement) {
                        loadingElement.remove();
                    }
                    
                    // Add error message
                    addMessage('ai', 'Sorry, there was an error processing your request.');
                });
            }

            // Function to add a message to the chat
            function addMessage(type, text, id = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'user' ? 'user-message' : 'ai-message';
                messageDiv.innerHTML = text;
                
                if (id) {
                    messageDiv.id = id;
                }
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Diagnostic for Minerva</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f0f4f8;
            color: #333;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2a4365;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #4a6bdf;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-result {
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        #test-container {
            height: 100px;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>React Diagnostic for Minerva</h1>
    <p>This page will diagnose issues with React, Babel, and JSX in your environment.</p>

    <div class="card">
        <h2>1. Library Loading Test</h2>
        <button onclick="checkLibraries()">Check Libraries</button>
        <div id="libraries-result"></div>
    </div>

    <div class="card">
        <h2>2. React Rendering Test</h2>
        <div id="test-container"></div>
        <button onclick="testReactRendering()">Test Basic React Rendering</button>
        <div id="react-result"></div>
    </div>

    <div class="card">
        <h2>3. JSX Transpilation Test</h2>
        <button onclick="testJSXTranspilation()">Test JSX Transpilation</button>
        <div id="jsx-result"></div>
    </div>

    <div class="card">
        <h2>4. React + Three.js Test</h2>
        <button onclick="testReactThree()">Test React Three.js Integration</button>
        <div id="react-three-result"></div>
    </div>

    <!-- Load libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@react-three/fiber@8.15.12/dist/react-three-fiber.min.js"></script>
    <script src="https://unpkg.com/@react-three/drei@9.92.3/index.min.js"></script>

    <!-- Diagnostic Scripts -->
    <script>
        // Test 1: Check if libraries are loaded correctly
        function checkLibraries() {
            const results = document.getElementById('libraries-result');
            
            const libraries = [
                { name: "React", check: () => typeof React !== 'undefined', version: () => React?.version },
                { name: "ReactDOM", check: () => typeof ReactDOM !== 'undefined', version: () => ReactDOM?.version },
                { name: "THREE.js", check: () => typeof THREE !== 'undefined', version: () => THREE?.version },
                { name: "Babel", check: () => typeof Babel !== 'undefined', version: () => "Loaded" },
                { name: "ReactThreeF", check: () => typeof ReactThreeF !== 'undefined', version: () => "Loaded" },
                { name: "drei", check: () => typeof drei !== 'undefined', version: () => "Loaded" }
            ];
            
            let html = '<div class="test-result ' + (libraries.every(lib => lib.check()) ? 'success' : 'error') + '">';
            
            libraries.forEach(lib => {
                const loaded = lib.check();
                html += `<div>${lib.name}: ${loaded ? '‚úÖ ' + lib.version() : '‚ùå Not loaded'}</div>`;
            });
            
            html += '</div>';
            results.innerHTML = html;
            
            // Report to console for debugging
            console.log("Library Check Results:");
            libraries.forEach(lib => {
                console.log(`${lib.name}: ${lib.check() ? lib.version() : 'Not loaded'}`);
            });
        }
        
        // Test 2: Basic React rendering
        function testReactRendering() {
            const results = document.getElementById('react-result');
            const container = document.getElementById('test-container');
            
            try {
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    throw new Error("React or ReactDOM is not loaded");
                }
                
                // Clear container
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
                
                // Create a simple React element
                const element = React.createElement('h2', { style: { color: '#4a6bdf' } }, 'React is working!');
                
                // Try to render it
                if (typeof ReactDOM.createRoot === 'function') {
                    // React 18+
                    const root = ReactDOM.createRoot(container);
                    root.render(element);
                } else {
                    // Older React
                    ReactDOM.render(element, container);
                }
                
                results.innerHTML = '<div class="test-result success">React rendering successful! ‚úÖ</div>';
                console.log("React rendering test: Success");
            } catch (error) {
                results.innerHTML = `<div class="test-result error">Error: ${error.message} ‚ùå</div>`;
                console.error("React rendering test failed:", error);
            }
        }
        
        // Test 3: JSX transpilation
        function testJSXTranspilation() {
            const results = document.getElementById('jsx-result');
            
            try {
                if (typeof Babel === 'undefined') {
                    throw new Error("Babel is not loaded");
                }
                
                // Try to transpile some JSX
                const jsx = `
                    function TestComponent() {
                        return <div style={{color: 'green'}}>JSX is working!</div>;
                    }
                `;
                
                // Transpile with Babel
                const transpiled = Babel.transform(jsx, { presets: ['react'] }).code;
                
                // Show the transpiled code
                results.innerHTML = `
                    <div class="test-result success">
                        <div>JSX transpilation successful! ‚úÖ</div>
                        <pre>${transpiled}</pre>
                    </div>
                `;
                console.log("JSX transpilation test: Success");
            } catch (error) {
                results.innerHTML = `<div class="test-result error">Error: ${error.message} ‚ùå</div>`;
                console.error("JSX transpilation test failed:", error);
            }
        }
        
        // Test 4: React Three.js integration
        function testReactThree() {
            const results = document.getElementById('react-three-result');
            
            try {
                if (typeof ReactThreeF === 'undefined' || typeof THREE === 'undefined') {
                    throw new Error("React Three Fiber or THREE.js is not loaded");
                }
                
                // Test if we can create a Three.js scene
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                
                results.innerHTML = `
                    <div class="test-result success">
                        <div>THREE.js integration successful! ‚úÖ</div>
                        <div>Scene created: ${scene instanceof THREE.Scene ? 'Yes' : 'No'}</div>
                        <div>Camera created: ${camera instanceof THREE.PerspectiveCamera ? 'Yes' : 'No'}</div>
                    </div>
                `;
                console.log("React Three.js test: Success");
            } catch (error) {
                results.innerHTML = `<div class="test-result error">Error: ${error.message} ‚ùå</div>`;
                console.error("React Three.js test failed:", error);
            }
        }
    </script>

    <!-- JSX Test -->
    <script type="text/babel">
        // This script tests if inline JSX works
        document.addEventListener('DOMContentLoaded', function() {
            const jsxTest = document.createElement('div');
            jsxTest.id = 'jsx-test';
            document.body.appendChild(jsxTest);
            
            // Very simple JSX component
            function TestJSX() {
                return <div style={{padding: '10px', background: '#e6f7ff', borderRadius: '4px', marginTop: '10px'}}>
                    This text is rendered with JSX! üéâ
                </div>;
            }
            
            try {
                // Try to render the JSX component
                if (typeof ReactDOM.createRoot === 'function') {
                    const root = ReactDOM.createRoot(jsxTest);
                    root.render(<TestJSX />);
                } else {
                    ReactDOM.render(<TestJSX />, jsxTest);
                }
                console.log("Inline JSX test: Success");
            } catch (error) {
                console.error("Inline JSX test failed:", error);
                jsxTest.innerHTML = `<div style="padding: 10px; background: #ffeaea; border-radius: 4px; margin-top: 10px;">
                    Error rendering JSX: ${error.message}
                </div>`;
            }
        });
    </script>
</body>
</html>

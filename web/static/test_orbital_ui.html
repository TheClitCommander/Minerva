<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minerva 3D Orbital UI - Test</title>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Global styles */
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100%;
            height: 100%;
            background-color: #0a0e17;
            color: #e6e6e6;
        }
        
        /* Full screen container for the orbital UI */
        #react-orbital-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: radial-gradient(circle at center, #131c2e 0%, #0a0e17 100%);
            overflow: hidden;
        }
        
        /* Loading screen */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #0a0e17;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading-logo {
            width: 150px;
            height: 150px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .loading-bar {
            width: 200px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }
        
        .loading-progress {
            position: absolute;
            height: 100%;
            background-color: #4a6bdf;
            animation: loading 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        
        @keyframes loading {
            0% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0%; left: 100%; }
        }
        
        /* Think Tank model panel */
        .think-tank-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(10, 14, 23, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            padding: 15px;
            width: 300px;
            z-index: 100;
        }
        
        .model-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .model-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .model-name {
            font-weight: bold;
        }
        
        .model-score {
            background: rgba(74, 107, 223, 0.2);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 14px;
            color: #4a6bdf;
        }
        
        .panel-title {
            margin-top: 0;
            color: #4a6bdf;
            border-bottom: 1px solid rgba(74, 107, 223, 0.3);
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .progress-bar {
            height: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            width: 100px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            border-radius: 3px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #e6e6e6;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-logo">
            <i class="fas fa-globe fa-5x" style="color: #4a6bdf;"></i>
        </div>
        <div class="loading-text">Initializing Orbital Interface</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
    </div>

    <!-- Think Tank Models Panel -->
    <div id="think-tank-panel" class="think-tank-panel" style="display: none;">
        <h3 class="panel-title">Think Tank Models</h3>
        <div class="model-item">
            <div class="model-header">
                <span class="model-name">GPT-4 Turbo</span>
                <span class="model-score">9.2</span>
            </div>
            <div class="setting-item">
                <span>Quality</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 92%; background-color: #4a6bdf;"></div>
                </div>
            </div>
            <div class="setting-item">
                <span>Relevance</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 95%; background-color: #28a745;"></div>
                </div>
            </div>
            <div class="setting-item">
                <span>Technical</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 89%; background-color: #fd7e14;"></div>
                </div>
            </div>
        </div>
        <div class="model-item">
            <div class="model-header">
                <span class="model-name">Claude 3 Opus</span>
                <span class="model-score">9.4</span>
            </div>
            <div class="setting-item">
                <span>Quality</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 94%; background-color: #4a6bdf;"></div>
                </div>
            </div>
            <div class="setting-item">
                <span>Relevance</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 93%; background-color: #28a745;"></div>
                </div>
            </div>
            <div class="setting-item">
                <span>Technical</span>
                <div class="progress-bar">
                    <div class="progress" style="width: 91%; background-color: #fd7e14;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main React container for the 3D Orbital UI -->
    <div id="react-orbital-ui"></div>

    <!-- React and Three.js Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/three@0.159.0/build/three.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React Three Fiber and Drei -->
    <script src="https://unpkg.com/@react-three/fiber@8.15.12/dist/react-three-fiber.min.js"></script>
    <script src="https://unpkg.com/@react-three/drei@9.92.3/index.min.js"></script>

    <!-- MinervaUI Component -->
    <script type="text/babel">
        // Create a simplified version of the MinervaUI component directly in this file
        const { useState, useRef, useEffect } = React;
        const { Canvas, useFrame, useThree } = ReactThreeF;
        const { OrbitControls, Html } = drei;
        
        // The core Orb component with glow effect
        function Orb({ position, color, scale, onClick, pulsate = false, label = null }) {
          const ref = useRef();
          const [hovered, setHovered] = useState(false);
          const [pulseScale, setPulseScale] = useState(1);
          
          // Handle self-rotation and pulsating animation if enabled
          useFrame((state) => {
            if (ref.current) {
              ref.current.rotation.y += 0.005;
              
              // Add pulsating effect if enabled
              if (pulsate) {
                const pulse = Math.sin(state.clock.elapsedTime * 2) * 0.05 + 1;
                setPulseScale(pulse);
              }
            }
          });
          
          // Calculate final scale including pulse effect
          const finalScale = scale.map(s => s * (pulsate ? pulseScale : 1));
          
          return (
            <group position={position}>
              <mesh 
                ref={ref} 
                scale={finalScale}
                onClick={onClick}
                onPointerOver={() => setHovered(true)}
                onPointerOut={() => setHovered(false)}
              >
                <sphereGeometry args={[1, 32, 32]} />
                <meshStandardMaterial 
                  color={color} 
                  emissive={color} 
                  emissiveIntensity={hovered ? 0.8 : 0.5} 
                  roughness={0.2}
                />
              </mesh>
              
              {/* Glow effect */}
              <mesh scale={[scale[0] * 1.2, scale[1] * 1.2, scale[2] * 1.2]}>
                <sphereGeometry args={[1, 16, 16]} />
                <meshStandardMaterial 
                  color={color} 
                  transparent={true} 
                  opacity={0.15} 
                  roughness={1}
                />
              </mesh>
              
              {/* Label if provided */}
              {label && (
                <Html position={[0, scale[1] * 1.5, 0]} center>
                  <div style={{ 
                    color: 'white', 
                    background: 'rgba(0,0,0,0.5)', 
                    padding: '4px 8px', 
                    borderRadius: '4px',
                    fontSize: '12px',
                    whiteSpace: 'nowrap'
                  }}>
                    {label}
                  </div>
                </Html>
              )}
            </group>
          );
        }
        
        // Agent Orb component that orbits around its project orb
        function AgentOrb({ position, color, radius, speed, onClick, active = false }) {
          const ref = useRef();
          const [angle, setAngle] = useState(Math.random() * Math.PI * 2); // Random starting position
          const [hovered, setHovered] = useState(false);
          const [clickable, setClickable] = useState(active);
          
          // Update clickable state when active prop changes
          useEffect(() => {
            setClickable(active);
          }, [active]);
          
          // Calculate orbital movement
          useFrame((state) => {
            if (ref.current) {
              // Update angle based on speed
              setAngle((prev) => prev + speed);
              
              // Update position in circular orbit
              ref.current.position.x = position[0] + radius * Math.cos(angle);
              ref.current.position.z = position[2] + radius * Math.sin(angle);
              
              // Add some vertical wobble for more interesting motion
              ref.current.position.y = position[1] + Math.sin(angle * 2) * 0.2;
              
              // Self-rotation
              ref.current.rotation.y += 0.01;
              ref.current.rotation.x += 0.005;
            }
          });
        
          return (
            <mesh 
              ref={ref} 
              scale={[0.5, 0.5, 0.5]}
              onClick={clickable ? onClick : null}
              onPointerOver={() => clickable && setHovered(true)}
              onPointerOut={() => setHovered(false)}
              cursor={clickable ? 'pointer' : 'default'}
            >
              <sphereGeometry args={[1, 24, 24]} />
              <meshStandardMaterial 
                color={color} 
                emissive={color} 
                emissiveIntensity={hovered ? 0.9 : 0.6} 
                roughness={0.3}
              />
              
              {/* Subtle glow for agents */}
              <pointLight 
                color={color} 
                intensity={0.5} 
                distance={1.5} 
                decay={2} 
              />
            </mesh>
          );
        }
        
        // Project Orb component that stays stationary with agents orbiting around it
        function ProjectOrb({ position, agents, color, name = null, active = false, onClick }) {
          const [isActive, setIsActive] = useState(active);
          
          // Update isActive state when active prop changes
          useEffect(() => {
            setIsActive(active);
          }, [active]);
          
          // Handle interaction with the project orb
          const handleClick = (e) => {
            e.stopPropagation();
            setIsActive(!isActive);
            if (onClick) onClick(e);
          };
          
          return (
            <group position={position}>
              {/* The main project orb */}
              <Orb 
                position={[0, 0, 0]} 
                color={color} 
                scale={[1.5, 1.5, 1.5]} 
                onClick={handleClick} 
                pulsate={isActive}
                label={name}
              />
              
              {/* Agent orbs orbiting the project */}
              {agents && agents.map((agent, i) => {
                const baseSpeed = 0.01; // Slower base speed
                const speedVariation = 0.005; // Less variation between agents
                
                return (
                  <AgentOrb 
                    key={i} 
                    position={[0, 0, 0]} 
                    radius={2 + i * 0.5} // Increasing orbit radius for each agent
                    speed={baseSpeed + speedVariation * i} 
                    color={agent.color}
                    active={isActive} // Agents become clickable when project is active
                    onClick={() => console.log(`Agent ${i} clicked`)}
                  />
                );
              })}
            </group>
          );
        }
        
        // Scene setup component for the starry background
        function SceneSetup() {
          const { scene } = useThree();
          
          useEffect(() => {
            // Create a starry background
            const stars = new THREE.BufferGeometry();
            const starCount = 2000;
            const positions = new Float32Array(starCount * 3);
            
            for (let i = 0; i < starCount * 3; i += 3) {
              positions[i] = (Math.random() - 0.5) * 100;
              positions[i + 1] = (Math.random() - 0.5) * 100;
              positions[i + 2] = (Math.random() - 0.5) * 100;
            }
            
            stars.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const starMaterial = new THREE.PointsMaterial({
              color: 0xffffff,
              size: 0.1,
              transparent: true,
              opacity: 0.8,
              sizeAttenuation: true
            });
            
            const starField = new THREE.Points(stars, starMaterial);
            scene.add(starField);
            
            return () => {
              scene.remove(starField);
              stars.dispose();
              starMaterial.dispose();
            };
          }, [scene]);
          
          return null;
        }
        
        // Main MinervaUI component that accepts projectOrbs as a prop
        function MinervaUI({ projectOrbs = [] }) {
          const [activeProjectIndex, setActiveProjectIndex] = useState(null);
          
          // Handle clicks on project orbs
          const handleProjectClick = (index) => {
            setActiveProjectIndex(index === activeProjectIndex ? null : index);
            
            // Show Think Tank panel when a project is activated
            const panel = document.getElementById('think-tank-panel');
            if (panel) {
              panel.style.display = index === activeProjectIndex ? 'none' : 'block';
            }
          };
          
          return (
            <Canvas camera={{ position: [0, 0, 15], fov: 50 }}>
              {/* Scene lighting */}
              <ambientLight intensity={0.2} />
              <pointLight position={[0, 0, 0]} intensity={0.8} color="#ffffff" />
              <hemisphereLight intensity={0.3} color="#4a6bdf" groundColor="#080820" />
              
              {/* Starry background */}
              <SceneSetup />
              
              {/* Main Minerva Orb at center */}
              <Orb 
                position={[0, 0, 0]} 
                color={"#6f42c1"} 
                scale={[2.5, 2.5, 2.5]} 
                pulsate={true}
                label="Minerva"
              />
              
              {/* Project orbs positioned around Minerva */}
              {projectOrbs.map((proj, i) => (
                <ProjectOrb 
                  key={i} 
                  position={proj.position} 
                  color={proj.color} 
                  agents={proj.agents} 
                  name={proj.name || `Project ${i + 1}`}
                  active={i === activeProjectIndex}
                  onClick={() => handleProjectClick(i)}
                />
              ))}
              
              {/* Camera controls */}
              <OrbitControls 
                enableZoom={true} 
                enablePan={false} 
                enableRotate={true}
                minDistance={5}
                maxDistance={25}
                dampingFactor={0.1}
                rotateSpeed={0.5}
              />
            </Canvas>
          );
        }
        
        // Configure the Think Tank model data
        function OrbitalApp() {
          const [loading, setLoading] = useState(true);
          
          useEffect(() => {
            // Simulate loading time
            const timer = setTimeout(() => {
              const loadingScreen = document.getElementById('loading-screen');
              loadingScreen.style.opacity = '0';
              setTimeout(() => {
                loadingScreen.style.display = 'none';
                setLoading(false);
              }, 500);
            }, 2000);
            
            return () => clearTimeout(timer);
          }, []);
          
          if (loading) return null;
          
          // Think Tank models data
          const thinkTankModels = [
            { 
              position: [4, 1, 0], 
              color: '#4a6bdf', // Blue
              name: "GPT-4 Turbo",
              agents: [
                { color: '#dc3545' }, // Red
                { color: '#28a745' }, // Green
                { color: '#ffc107' }  // Yellow
              ]
            },
            { 
              position: [-4, -1, 0], 
              color: '#28a745', // Green
              name: "Claude 3 Opus",
              agents: [
                { color: '#fd7e14' }, // Orange
                { color: '#6f42c1' }  // Purple
              ]
            },
            { 
              position: [0, 4, 0], 
              color: '#6f42c1', // Purple
              name: "Mistral Large",
              agents: [
                { color: '#17a2b8' }, // Cyan
                { color: '#dc3545' }, // Red
                { color: '#ffc107' }  // Yellow
              ]
            },
            { 
              position: [-2, -3, 2], 
              color: '#fd7e14', // Orange 
              name: "Gemini Pro",
              agents: [
                { color: '#17a2b8' }, // Cyan
                { color: '#20c997' }  // Teal
              ]
            }
          ];
          
          return <MinervaUI projectOrbs={thinkTankModels} />;
        }
        
        // Render the React application
        document.addEventListener('DOMContentLoaded', function() {
          const container = document.getElementById('react-orbital-ui');
          const root = ReactDOM.createRoot(container);
          root.render(<OrbitalApp />);
          
          // Add keyboard shortcut for toggling the Think Tank panel (press 'T')
          document.addEventListener('keydown', function(e) {
            if (e.key === 't' || e.key === 'T') {
              const panel = document.getElementById('think-tank-panel');
              panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
          });
        });
    </script>
</body>
</html>
